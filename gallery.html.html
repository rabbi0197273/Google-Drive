<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="drive-logo.png">
    <title>PhotoPlyr Gallery - My Saved Photos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .glass {
            background: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
        }
        .photo-card {
            transition: transform 0.2s;
        }
        .photo-card:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-gray-100">

<div class="container mx-auto py-8 px-4">
    <!-- Header -->
    <div class="text-center mb-8">
        <img src="drive-logo.png" alt="PhotoPlyr" class="mx-auto h-16 mb-4">
        <h1 class="text-3xl font-bold text-gray-800">My Photo Gallery</h1>
        <p class="text-gray-600">‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∏‡¶Ç‡¶∞‡¶ï‡ßç‡¶∑‡¶ø‡¶§ ‡¶õ‡¶¨‡¶ø‡¶ó‡ßÅ‡¶≤‡ßã</p>
    </div>

    <!-- Actions -->
    <div class="max-w-4xl mx-auto mb-6 flex flex-wrap justify-between items-center gap-4">
        <div class="flex gap-3">
            <a href="convert.html" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-600">
                ‚ûï Add Photos
            </a>
            <a href="index.html" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600">
                üè† Home
            </a>
        </div>
        
        <div class="flex gap-3">
            <button onclick="exportPhotos()" class="bg-green-500 text-white px-4 py-2 rounded hover:bg-green-600">
                üì• Export All
            </button>
            <label class="bg-orange-500 text-white px-4 py-2 rounded hover:bg-orange-600 cursor-pointer">
                üì§ Import
                <input type="file" id="importFile" accept=".json" style="display: none;" onchange="handleImport(this)">
            </label>
            <button onclick="clearAll()" class="bg-red-500 text-white px-4 py-2 rounded hover:bg-red-600">
                üóëÔ∏è Clear All
            </button>
        </div>
    </div>

    <!-- Stats -->
    <div class="max-w-4xl mx-auto mb-6 glass rounded-lg p-4">
        <div class="grid grid-cols-3 gap-4 text-center">
            <div>
                <div class="text-2xl font-bold text-blue-600" id="totalPhotos">0</div>
                <div class="text-sm text-gray-600">Total Photos</div>
            </div>
            <div>
                <div class="text-2xl font-bold text-green-600" id="totalViews">0</div>
                <div class="text-sm text-gray-600">Total Views</div>
            </div>
            <div>
                <div class="text-2xl font-bold text-purple-600" id="storageUsed">0 KB</div>
                <div class="text-sm text-gray-600">Storage Used</div>
            </div>
        </div>
    </div>

    <!-- Photo Grid -->
    <div class="max-w-6xl mx-auto">
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4" id="photoGrid">
            <!-- Photos will be loaded here -->
        </div>
        
        <!-- Empty State -->
        <div id="emptyState" class="text-center py-12" style="display: none;">
            <div class="text-6xl mb-4">üì∑</div>
            <h3 class="text-xl font-semibold text-gray-700 mb-2">No Photos Yet</h3>
            <p class="text-gray-500 mb-4">Start by adding some photos from Google Drive</p>
            <a href="convert.html" class="bg-blue-500 text-white px-6 py-3 rounded-lg hover:bg-blue-600">
                Add Your First Photo
            </a>
        </div>
    </div>
</div>

<script src="photos-data.js"></script>
<script>
    // Load and display photos
    function loadPhotos() {
        const photos = getAllPhotos();
        const photoGrid = document.getElementById('photoGrid');
        const emptyState = document.getElementById('emptyState');
        
        if (photos.length === 0) {
            photoGrid.style.display = 'none';
            emptyState.style.display = 'block';
            return;
        }
        
        emptyState.style.display = 'none';
        photoGrid.style.display = 'grid';
        
        photoGrid.innerHTML = photos.map(photo => `
            <div class="bg-white rounded-lg shadow-md overflow-hidden photo-card">
                <div class="aspect-w-1 aspect-h-1">
                    <img src="${photo.thumbnail}" alt="${photo.title}" 
                         class="w-full h-48 object-cover cursor-pointer"
                         onclick="openPhoto('${photo.driveId}')">
                </div>
                <div class="p-3">
                    <h3 class="font-semibold text-sm text-gray-800 truncate">${photo.title}</h3>
                    <p class="text-xs text-gray-500 mt-1">Views: ${photo.views}</p>
                    <p class="text-xs text-gray-400">${new Date(photo.dateAdded).toLocaleDateString()}</p>
                    
                    <div class="flex gap-2 mt-3">
                        <button onclick="copyLink('${photo.directLink}')" 
                                class="text-xs bg-blue-100 text-blue-600 px-2 py-1 rounded hover:bg-blue-200">
                            üîó Copy
                        </button>
                        <button onclick="downloadPhoto('${photo.directLink}', '${photo.title}')" 
                                class="text-xs bg-green-100 text-green-600 px-2 py-1 rounded hover:bg-green-200">
                            ‚¨áÔ∏è Download
                        </button>
                        <button onclick="deletePhotoConfirm('${photo.driveId}')" 
                                class="text-xs bg-red-100 text-red-600 px-2 py-1 rounded hover:bg-red-200">
                            üóëÔ∏è
                        </button>
                    </div>
                </div>
            </div>
        `).join('');
        
        updateStats();
    }
    
    // Update statistics
    function updateStats() {
        const photos = getAllPhotos();
        document.getElementById('totalPhotos').textContent = photos.length;
        document.getElementById('totalViews').textContent = photos.reduce((sum, p) => sum + p.views, 0);
        
        const storageSize = JSON.stringify(photos).length;
        document.getElementById('storageUsed').textContent = (storageSize / 1024).toFixed(1) + ' KB';
    }
    
    // Open photo viewer
    function openPhoto(driveId) {
        updateViews(driveId);
        const base = btoa(JSON.stringify({id: driveId}));
        window.location.href = `photos.html?id=${base}`;
    }
    
    // Copy direct link
    function copyLink(link) {
        navigator.clipboard.writeText(link).then(() => {
            alert('Link copied to clipboard! ‚úÖ');
        }).catch(() => {
            prompt('Copy this link:', link);
        });
    }
    
    // Download photo
    function downloadPhoto(link, title) {
        const a = document.createElement('a');
        a.href = link;
        a.download = title + '.jpg';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
    }
    
    // Delete photo with confirmation
    function deletePhotoConfirm(driveId) {
        if (confirm('Are you sure you want to delete this photo?')) {
            deletePhoto(driveId);
            loadPhotos();
        }
    }
    
    // Clear all photos
    function clearAll() {
        if (confirm('Are you sure you want to delete ALL photos? This cannot be undone!')) {
            localStorage.removeItem('savedPhotos');
            location.reload();
        }
    }
    
    // Handle file import
    function handleImport(input) {
        const file = input.files[0];
        if (file) {
            importPhotos(file);
        }
    }
    
    // Load photos on page load
    loadPhotos();
</script>
</body>
</html>